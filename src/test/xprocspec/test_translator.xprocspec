<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.daisy.org/ns/xprocspec"
               xmlns:p="http://www.w3.org/ns/xproc"
               xmlns:px="http://www.daisy.org/ns/pipeline/xproc"
               xmlns:html="http://www.w3.org/1999/xhtml"
               xmlns:pxi="http://www.daisy.org/ns/pipeline/xproc/internal">
  
  <x:script>
    <p:declare-step type="pxi:transform" version="1.0">
      <p:input port="source"/>
      <p:output port="result"/>
      <p:option name="grade" required="true"/>
      <p:import href="http://www.daisy.org/pipeline/modules/braille/common-utils/library.xpl"/>
      <p:add-attribute match="/*" attribute-name="style" attribute-value="hyphens:auto"/>
      <p:add-attribute match="html:p" attribute-name="style" attribute-value="display:block"/>
      <px:transform type="css-block">
        <p:with-option name="query" select="concat('(translator:nlb)(grade:',$grade,')')"/>
      </px:transform>
      <p:delete match="@style"/>
    </p:declare-step>
  </x:script>
  
  <x:scenario label="Grade 0, 1, 2 and 3">
    <x:call step="pxi:transform">
      <x:input port="source">
        <x:document type="inline">
          <div xmlns="http://www.w3.org/1999/xhtml">
            <p>foobar</p>
          </div>
        </x:document>
      </x:input>
    </x:call>
    
    <x:scenario label="grade 0">
      <x:call>
        <x:option name="grade" select="'0'"/>
      </x:call>
      <x:context label="result">
        <x:document type="port" port="result"/>
      </x:context>
      <x:expect label="result" type="compare">
        <x:document type="inline">
          <div xmlns="http://www.w3.org/1999/xhtml">
            <p>⠋⠕⠕­⠃⠁⠗</p>
          </div>
        </x:document>
      </x:expect>
    </x:scenario>
    
    <x:scenario label="grade 1">
      <x:call>
        <x:option name="grade" select="'1'"/>
      </x:call>
      <x:context label="result">
        <x:document type="port" port="result"/>
      </x:context>
      <x:expect label="result" type="compare">
        <x:document type="inline">
          <div xmlns="http://www.w3.org/1999/xhtml">
            <p>⠋⠕⠕­⠃⠼</p>
          </div>
        </x:document>
      </x:expect>
    </x:scenario>
    
    <x:scenario label="grade 2">
      <x:call>
        <x:option name="grade" select="'2'"/>
      </x:call>
      <x:context label="result">
        <x:document type="port" port="result"/>
      </x:context>
      <x:expect label="result" type="compare">
        <x:document type="inline">
          <div xmlns="http://www.w3.org/1999/xhtml">
            <p>⠋⠕⠕­⠃⠼</p>
          </div>
        </x:document>
      </x:expect>
    </x:scenario>
    
    <x:scenario label="grade 3">
      <x:call>
        <x:option name="grade" select="'3'"/>
      </x:call>
      <x:context label="result">
        <x:document type="port" port="result"/>
      </x:context>
      <x:expect label="result" type="compare">
        <x:document type="inline">
          <div xmlns="http://www.w3.org/1999/xhtml">
            <p>⠋⠕⠕­⠃⠼</p>
          </div>
        </x:document>
      </x:expect>
    </x:scenario>
  </x:scenario>
  
  <x:scenario label="Marking of text-level semantics with braille indicators for Norwegian">
    <x:call step="pxi:transform">
      <x:input port="source">
        <x:document type="inline">
          <div xmlns="http://www.w3.org/1999/xhtml">
            <!--
                Always use dots 23 (⠆) in front of bold and dots 56 (⠰) after bold.
            -->
            <p>
              hund hund<strong>en</strong> hund<strong>er</strong> hund<strong>ene</strong>
            </p>
            <!--
                Opening/closing marks are never placed immediately before/after a white space character.
            -->
            <p>
              hund hund<strong>en </strong>hund<strong>er </strong>hund<strong>ene</strong>
            </p>
            <p>
              Det var bare det at hun også <strong>mis</strong>unte ham det
            </p>
            <p>
              Jeg verken <strong>vil </strong>eller <strong>kan </strong>gjøre dette for deg!
            </p>
            <p>
              Karin Fossum slo gjennom som krimforfatter med romanen <strong>Evas øye</strong>, som
              kom ut i 1995.
            </p>
            <!--
                Always use dots 456 (⠸) in front of and after underline.
            -->
            <p>
              "Hør her: <strong>du <u>må </u>gjøre det</strong>!"
            </p>
            <!--
                Always use dots 6-3 (⠆⠠) in front of and after italics.
            -->
            <p>
              Romanen <strong>Tusen strålende soler </strong>av den afghansk-amerikanske forfatteren
              Khaled Hosseini tyder på å bli en like stor suksess som den forrige romanen,
              <strong>Drageløperen</strong>. I bokanmeldelsen fra <strong>Dagbladet
              </strong>06.06.07 forklares dette med: <em>Ikke fordi Hosseini er en spesielt god
              forfatter. Men fordi tematikken til den USA-bosatte Hosseini, har en spesiell dragning
              på et vestlig publikum.</em>
            </p>
            <p>
              Vinje, Finn-Erik. 2004. <em>Skriveregler</em>. 8. utg. Oslo
            </p>
            <p>
              Hellevik, Alf. 1970. <em>God nynorsk</em>.  Oslo
            </p>
            <p>
              Ny afghansk bestselger. Bokanmeldelse <em>Dagbladet </em>06.06.07
            </p>
          </div>
        </x:document>
      </x:input>
      <x:option name="grade" select="'0'"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="compare" pending="no perfect translation">
      <x:document type="inline">
        <div xmlns="http://www.w3.org/1999/xhtml">
          <p>
            ⠓⠥⠝⠙ ⠓⠥⠝⠙<strong>⠆⠑⠝⠰</strong> ⠓⠥⠝⠙<strong>⠆⠑⠗⠰</strong> ⠓⠥⠝⠙<strong>⠆⠑⠝⠑⠰</strong>
          </p>
          <p>
            ⠓⠥⠝⠙ ⠓⠥⠝⠙<strong>⠆⠑⠝⠰ </strong>⠓⠥⠝⠙<strong>⠆⠑⠗⠰ </strong>⠓⠥⠝⠙<strong>⠆⠑⠝⠑⠰</strong>
          </p>
          <p>
            ⠠⠙⠑⠞ ⠧⠁⠗ ⠃⠁⠗⠑ ⠙⠑⠞ ⠁⠞ ⠓⠥⠝ ⠕⠛⠎⠡ <strong>⠆⠍⠊⠎⠰</strong>⠥⠝⠞⠑ ⠓⠁⠍ ⠙⠑⠞⠄
          </p>
          <p>
            ⠠⠚⠑⠛ ⠧⠑⠗⠅⠑⠝ <strong>⠆⠧⠊⠇⠰ </strong>⠑⠇⠇⠑⠗ <strong>⠆⠅⠁⠝⠰ </strong>⠛⠚⠪⠗⠑ ⠙⠑⠞⠞⠑ ⠋⠕⠗ ⠙⠑⠛⠖
          </p>
          <p>
            ⠠⠅⠁⠗⠊⠝ ⠠⠋⠕⠎⠎⠥⠍ ⠎⠇⠕ ⠛⠚⠑⠝⠝⠕⠍ ⠎⠕⠍ ⠅⠗⠊⠍⠋⠕⠗⠋⠁⠞⠞⠑⠗ ⠍⠑⠙ ⠗⠕⠍⠁⠝⠑⠝ <strong>⠆⠑⠧⠁⠎ ⠪⠽⠑⠰</strong>⠂
            ⠎⠕⠍ ⠅⠕⠍ ⠥⠞ ⠊ ⠼⠁⠊⠊⠑⠄
          </p>
          <p>
            ⠲⠠⠓⠪⠗ ⠓⠑⠗⠒ <strong>⠆⠙⠥ <u>⠸⠍⠡⠸ </u>⠛⠚⠪⠗⠑ ⠙⠑⠞⠰</strong>⠖⠲
          </p>
          <p>
            ⠠⠗⠕⠍⠁⠝⠑⠝ <strong>⠆⠠⠞⠥⠎⠑⠝ ⠎⠞⠗⠡⠇⠑⠝⠙⠑ ⠎⠕⠇⠑⠗⠰ </strong>⠁⠧ ⠙⠑⠝ ⠁⠋⠛⠓⠁⠝⠎⠅⠁⠍⠑⠗⠊⠅⠁⠝⠎⠅⠑
            ⠋⠕⠗⠋⠁⠞⠞⠑⠗⠑⠝ ⠠⠅⠓⠁⠇⠑⠙ ⠠⠓⠕⠎⠎⠑⠊⠝⠊ ⠞⠽⠙⠑⠗ ⠏⠡ ⠡ ⠃⠇⠊ ⠑⠝ ⠇⠊⠅⠑ ⠎⠞⠕⠗ ⠎⠥⠅⠎⠑⠎⠎ ⠎⠕⠍ ⠙⠑⠝ ⠋⠕⠗⠗⠊⠛⠑
            ⠗⠕⠍⠁⠝⠑⠝⠂ <strong>⠆⠠⠙⠗⠁⠛⠑⠇⠪⠏⠑⠗⠑⠝⠰</strong>⠄ ⠠⠊ ⠃⠕⠅⠁⠝⠍⠑⠇⠙⠑⠇⠎⠑⠝ ⠋⠗⠁ <strong>⠆⠠⠙⠁⠛⠃⠇⠁⠙⠑⠞⠰
            </strong>⠼⠚⠋⠄⠚⠋⠄⠚⠛ ⠋⠕⠗⠅⠇⠁⠗⠑⠎ ⠙⠑⠞⠞⠑ ⠍⠑⠙⠒ <em>⠠⠄⠊⠅⠅⠑ ⠋⠕⠗⠙⠊ ⠠⠓⠕⠎⠎⠑⠊⠝⠊ ⠑⠗ ⠑⠝ ⠎⠏⠑⠎⠊⠑⠇⠞ ⠛⠕⠙
            ⠋⠕⠗⠋⠁⠞⠞⠑⠗⠄ ⠠⠍⠑⠝ ⠋⠕⠗⠙⠊ ⠞⠑⠍⠁⠞⠊⠅⠅⠑⠝ ⠞⠊⠇ ⠙⠑⠝ ⠠⠠⠥⠎⠁⠃⠕⠎⠁⠞⠞⠑ ⠠⠓⠕⠎⠎⠑⠊⠝⠊⠂ ⠓⠁⠗ ⠑⠝ ⠎⠏⠑⠎⠊⠑⠇⠇
            ⠙⠗⠁⠛⠝⠊⠝⠛ ⠏⠡ ⠑⠞ ⠧⠑⠎⠞⠇⠊⠛ ⠏⠥⠃⠇⠊⠅⠥⠍⠄⠠⠄</em>
          </p>
          <p>
            ⠠⠧⠊⠝⠚⠑⠂ ⠠⠋⠊⠝⠝⠤⠠⠑⠗⠊⠅⠄ ⠼⠃⠚⠚⠙⠄ <em>⠠⠄⠠⠎⠅⠗⠊⠧⠑⠗⠑⠛⠇⠑⠗⠠⠄</em>⠄ ⠼⠓⠄ ⠥⠞⠛⠄⠠⠕⠎⠇⠕
          </p>
          <p>
            ⠠⠓⠑⠇⠇⠑⠧⠊⠅⠂ ⠠⠁⠇⠋⠄ ⠼⠁⠊⠛⠚⠄ <em>⠠⠄⠛⠕⠙ ⠝⠽⠝⠕⠗⠎⠅⠠⠄</em>⠄ ⠠⠕⠎⠇⠕
          </p>
          <p>
            ⠠⠝⠽ ⠁⠋⠛⠓⠁⠝⠎⠅ ⠃⠑⠎⠞⠎⠑⠇⠛⠑⠗⠄⠃⠕⠅⠁⠝⠍⠑⠇⠙⠑⠇⠎⠑ <em>⠠⠄⠙⠁⠛⠃⠇⠁⠙⠑⠞⠠⠄</em>⠼⠚⠋⠄⠚⠋⠄⠚⠛
          </p>
        </div>
      </x:document>
    </x:expect>
  </x:scenario>
    
</x:description>
